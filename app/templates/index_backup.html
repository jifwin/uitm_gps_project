<!DOCTYPE html>


<html>
  <script src="https://open.mapquestapi.com/sdk/js/v7.2.s/mqa.toolkit.js?key=Fmjtd%7Cluu82q02nu%2C2w%3Do5-94yn0f
"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript">

    domain = window.location.hostname;

    // An example of using the MQA.EventUtil to hook into the window load event and execute the defined
    // function passed in as the last parameter. You could alternatively create a plain function here and
    // have it executed whenever you like (e.g. <body onload="yourfunction">).
 
    MQA.EventUtil.observe(window, 'load', function() {

        // create an object for options
        var options = {
            elt: document.getElementById('map'),           // ID of map element on page
            zoom: 5,                                      // initial zoom level of the map
            latLng: {lat: 50, lng: 19},  					// center of map in latitude/longitude   { lat: 52, lng: 21 },
            mtype: 'map',                                  // map type (map, sat, hyb); defaults to map
            bestFitMargin: 0,                              // margin offset from map viewport when applying a bestfit on shapes
            zoomOnDoubleClick: true                        // enable map to be zoomed in when double-clicking on map
        };

        // construct an instance of MQA.TileMap with the options object
        window.map = new MQA.TileMap(options);
        MQA.withModule('largezoom', function () {
                map.addControl(new MQA.LargeZoom());

            });
            MQA.withModule('mousewheel', function () {
                map.enableMouseWheelZoom();

            });
            loc(map);
            //console.log("jest2");


        });
function loc(map) {


    $.getJSON('https://' + domain + ':8443/last', function(locations) {
        locations = locations["locations"];


        map.removeAllShapes();
	for(var i = 0;i<locations.length;i++) {
		var basic = new MQA.Poi({lat: locations[i].lat, lng: locations[i].long});
        basic.setRolloverContent(locations[i].username);
        var icon = new MQA.Icon('/static/img/dot.png', 12, 12);

        // set the POI to use the MQA.Icon object instead of its default icon
        basic.setIcon(icon);

        map.addShape(basic);

        MQA.withModule('shapes', function() {
            var circle = new MQA.CircleOverlay();
            circle.radiusUnit = 'KM';
            console.log(i);
            circle.radius = [locations[i].precision/1000];
            //console.log(locations[i].precision);
            circle.shapePoints = [locations[i].lat, locations[i].long];
            circle.color=['#0000FF'];

            // set the alpha transparency of the border
            circle.colorAlpha = 0.3;

            // set the width of the border
            circle.borderWidth = 4;

            // set the fill color
            circle.fillColor = '#0000FF';

            // set the alpha transparency of the fill
            circle.fillColorAlpha = 0.2;

            map.addShape(circle);
        });


	};
    });

    setTimeout("loc(map)",1000);
};
  </script>
 <head>
    <meta charset="utf-8">
      <title>Pomidor</title>

       <link href="/static/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Home</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Options <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="#">Akcja 1</a></li>
                <li><a href="#">Akcja 2</a></li>
                <li><a href="#">Cos innego</a></li>
                <li class="divider"></li>
                <li><a href="#">Odseparowany link</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
 
			<div id="map" style="width:96%; height:500px; margin-left:2%;"></div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/static/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>


</body>
</html>
